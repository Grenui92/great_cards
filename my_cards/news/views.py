import json
import urllib.request
import datetime

from django.shortcuts import render
from django.views import View
from django.views.generic import ListView

# {'title': "China and Latin America's renewable energy boom",
#  'description': 'Chile is a clear example of just how deeply embedded in Latin America China has become.',
#  'content': 'The story of renewable energy’s rapid rise in Latin America often focuses on Chinese influence, and for good reason. China’s government, banks and companies have propelled the continent’s energy transition, with about 90% of all wind and solar techno... [7486 chars]',
#  'url': 'https://fortune.com/2023/07/08/china-secretly-fueling-latin-america-renewable-energy-boom-chile/',
#  'image': 'https://content.fortune.com/wp-content/uploads/2023/07/GettyImages-1139001201-e1688819040814.jpg?resize=1200,600', 'publishedAt': '2023-07-08T04:00:00Z',
#  'source': {'name': 'Fortune', 'url': 'https://fortune.com'}}


class NewsListView(ListView):
    template_name = 'news/index.html'
    paginate_by = 3
    news_api_key = '456a4af002fc4dc4b8f50966a622fb72'
    target_data = (datetime.datetime.now() - datetime.timedelta(days=10)).replace(hour=0, minute=0, second=0, microsecond=0)

    def get_queryset(self):
        response = b'{"totalArticles":8,"articles":[{"title":"Why Maryland became a haven for abortion care after Roe\xe2\x80\x99s fall","description":"The state has emerged as an example of how Democratic lawmakers can take proactive steps to bolster abortion access","content":"When the US supreme court upended the federal right to abortion enshrined in Roe v Wade, the immediate task before Democrats seemed simple: keep abortion legal in as many states as possible.\\nBut over a year since Roe\xe2\x80\x99s demise, some leaders in the rep... [6493 chars]","url":"https://www.theguardian.com/world/2023/jul/22/maryland-abortion-bolstering-access","image":"https://i.guim.co.uk/img/media/dca43f56a2b674fe2a72d749a5b3175d5d366c8f/0_261_6000_3601/master/6000.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=9e758db0f177ec2c86e00b36506c7caa","publishedAt":"2023-07-22T10:00:10Z","source":{"name":"The Guardian","url":"https://www.theguardian.com"}},{"title":"How Spain\xe2\x80\x99s conservatives joined forces with far-right Vox","description":"Some in Extremadura region see local outcome as latest example of People\xe2\x80\x99s party putting pragmatism over principles","content":"Towards the end of last month, Mar\xc3\xada Guardiola, who leads the conservative People\xe2\x80\x99s party (PP) in the Extremadura region of south-west Spain, gave a speech in which she tore into the far-right Vox party for its denial of gender-based violence, its de... [7627 chars]","url":"https://www.theguardian.com/world/2023/jul/21/how-spains-conservatives-joined-forces-with-far-right-vox","image":"https://i.guim.co.uk/img/media/573a17585f92b8abae9588ec449aa968c8745757/1285_628_3572_2143/master/3572.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=c6a94a963a8cb122b0baf549ec1125f0","publishedAt":"2023-07-21T05:00:33Z","source":{"name":"The Guardian","url":"https://www.theguardian.com"}},{"title":"Alfa Romeo 4C Designer\'s Cut Teases Inspiration For Upcoming Unique Model","description":"The 4C entered production in 2013, and Alfa decided to celebrate the now-defunct sports car\'s 10th anniversary by building a unique example.","content":"The Alfa Romeo 4C brought the Italian brand back to the United States, not counting the handful of 8C Competizione supercars in the country. The 4C entered production in 2013, and Alfa decided to celebrate the now-defunct sports car for its 10th anni... [2092 chars]","url":"https://www.motor1.com/news/677732/alfa-romeo-4c-designers-cut-special-edition-teasers/","image":"https://cdn.motor1.com/images/mgl/L372BM/s1/alfa-romeo-4c-designer-s-cut.jpg","publishedAt":"2023-07-19T11:47:00Z","source":{"name":"Motor1 ","url":"https://www.motor1.com"}},{"title":"Jesse Lingard and Rio Ferdinand example can help Amad at Manchester United this season","description":"Manchester United\'s pre-season tour of America will be an opportunity for the likes of Amad to prove themselves to Erik ten Hag","content":"Sign up for our daily newsletter to get the day\'s biggest stories sent direct to your inbox\\nManchester United have always had a pathway from the academy to first team and this summer\'s pre-season tour provides a chance for the new generation of young... [2215 chars]","url":"https://www.manchestereveningnews.co.uk/sport/football/football-news/man-united-academy-news-tour-27306459","image":"https://i2-prod.manchestereveningnews.co.uk/sport/football/football-news/article27306516.ece/ALTERNATES/s1200/0_GettyImages-173347497.jpg","publishedAt":"2023-07-17T01:00:00Z","source":{"name":"Manchester Evening News","url":"https://www.manchestereveningnews.co.uk"}},{"title":"Russian Duma passes draft law banning gender change","description":"Bill going through parliament is latest example of crackdown on LGBTQ+ rights under Vladimir Putin","content":"A sweeping Russian draft law to ban legally or medically changing gender has been approved by the lower house of parliament in its final reading, part of a crackdown against LGBTQ+ rights under the president, Vladimir Putin.\\nThe bill would bar Russia... [2458 chars]","url":"https://www.theguardian.com/world/2023/jul/14/russian-duma-passes-draft-law-banning-gender-change","image":"https://i.guim.co.uk/img/media/67dc51ce477bb0f1f26a2a0a9f7e52c875ed9f4a/116_0_3440_2065/master/3440.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=400f527096d1db7e8b3c189d89190bc4","publishedAt":"2023-07-14T09:56:23Z","source":{"name":"The Guardian","url":"https://www.theguardian.com"}},{"title":"The Bear: the best show of 2022 is back - and it\xe2\x80\x99s the perfect example of how to ace a second series","description":"It\xe2\x80\x99s wild we\xe2\x80\x99ve been messing around with Timoth\xc3\xa9e Chalamet when we already had Jeremy Allen White as a Michelin-level chef in a white T-shirt trying to turn around a doomed Chicago sandwich shop","content":"To punish myself for living an imperfect life, I sometimes watch a really terrible TV series right to the very end, just to make sure I am right about it (I always am). This is how I ended up watching the second series of True Detective, which is dre... [4569 chars]","url":"https://www.theguardian.com/tv-and-radio/2023/jul/14/the-bear-the-best-show-of-2022-is-back-and-its-the-perfect-example-of-how-to-ace-a-second-series","image":"https://i.guim.co.uk/img/media/5d1cf33fc277374a0200fcc718853af898c169b8/0_71_3825_2295/master/3825.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=02922dd8cc2caf48bb41735266ba2f55","publishedAt":"2023-07-14T06:00:04Z","source":{"name":"The Guardian","url":"https://www.theguardian.com"}},{"title":"Watch BMW M140i Hit 155+ MPH On The Autobahn With Zero Efforts","description":"As far as we know, the car featured in the video at the top of this page is a completely stock example. That doesn\'t make it slow, though.","content":"The second-generation BMW 1 Series known internally as the F20 (five-door) and F21 (three-door) was launched back in 2011 and stayed in production until 2019. It remains the brand\xe2\x80\x99s last rear-wheel-drive hatchback to date that was also available with... [1754 chars]","url":"https://www.motor1.com/news/676910/bmw-m140i-155-mph-autobahn-video/","image":"https://cdn.motor1.com/images/mgl/KbB4wA/s1/bmw-m140i-autobahn-run.jpg","publishedAt":"2023-07-14T04:47:00Z","source":{"name":"Motor1 ","url":"https://www.motor1.com"}},{"title":"Joan Is Awful: Black Mirror episode is every striking actor\xe2\x80\x99s worst nightmare","description":"The AI satire in the most recent season has been used as an example of why the Screen Actors Guild must strike to protect their careers","content":"With the most recent season of Black Mirror, you sensed that Charlie Brooker was keen to move away from his reputation as a prophet. Time and time again since his series hit the air, it has managed to correctly predict the future in all sorts of horr... [4223 chars]","url":"https://www.theguardian.com/tv-and-radio/2023/jul/13/joan-is-awful-black-mirror-striking-actors-nightmare","image":"https://i.guim.co.uk/img/media/7ac8ef9a33cec99e795625759a6c22ce1eb274f0/588_231_2825_1695/master/2825.jpg?width=1200&height=630&quality=85&auto=format&fit=crop&overlay-align=bottom%2Cleft&overlay-width=100p&overlay-base64=L2ltZy9zdGF0aWMvb3ZlcmxheXMvdGctZGVmYXVsdC5wbmc&enable=upscale&s=ba06e52d235746ce863c7cde3334997e","publishedAt":"2023-07-13T13:45:17Z","source":{"name":"The Guardian","url":"https://www.theguardian.com"}}]}'
        response = json.loads(response)
        return response['articles']


        # url = f"https://gnews.io/api/v4/search?q=example&lang=en&country=gb" \
        #       f"&from={self.target_data.date()}T{self.target_data.time()}Z" \
        #       f"&apikey={self.news_api_key}"
        # with urllib.request.urlopen(url) as response:
        #     response = response.read()
        #     response = json.loads(response)

        # return response['articles']
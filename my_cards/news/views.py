import json
import urllib.request
import datetime

from django.shortcuts import render
from django.views import View
from django.views.generic import ListView

# {'title': "China and Latin America's renewable energy boom",
#  'description': 'Chile is a clear example of just how deeply embedded in Latin America China has become.',
#  'content': 'The story of renewable energy’s rapid rise in Latin America often focuses on Chinese influence, and for good reason. China’s government, banks and companies have propelled the continent’s energy transition, with about 90% of all wind and solar techno... [7486 chars]',
#  'url': 'https://fortune.com/2023/07/08/china-secretly-fueling-latin-america-renewable-energy-boom-chile/',
#  'image': 'https://content.fortune.com/wp-content/uploads/2023/07/GettyImages-1139001201-e1688819040814.jpg?resize=1200,600', 'publishedAt': '2023-07-08T04:00:00Z',
#  'source': {'name': 'Fortune', 'url': 'https://fortune.com'}}


class NewsView(View):

    news_api_key = '456a4af002fc4dc4b8f50966a622fb72'
    target_data = (datetime.datetime.now() - datetime.timedelta(days=10)).replace(hour=0, minute=0, second=0, microsecond=0)

    def get(self, request):
        url = f"https://gnews.io/api/v4/search?q=example&lang=en&country=gb" \
              f"&from={self.target_data.date()}T{self.target_data.time()}Z" \
              f"&apikey={self.news_api_key}"
        with urllib.request.urlopen(url) as response:
            response = json.loads(response)

        return render(request, 'news/index.html', context={'magazine': response['articles']})

class NewsListView(ListView):
    template_name = 'news/index.html'
    paginate_by = 3
    news_api_key = '456a4af002fc4dc4b8f50966a622fb72'
    target_data = (datetime.datetime.now() - datetime.timedelta(days=10)).replace(hour=0, minute=0, second=0, microsecond=0)

    def get_queryset(self):
        response = b'{"totalArticles":3132,"articles":[{"title":"NFL Teams That Must Consider Tanking for Caleb Williams in 2024 Draft as Top Priority","description":"Tanking in the NFL is a taboo subject. It\'s not nearly as accepted as a form toward team improvement as it is in the NBA, for example. No league openly\xe2\x80\xa6","content":"0 of 6\\nAP Photo/Mark J. Terrill\\nTanking in the NFL is a taboo subject. It\'s not nearly as accepted as a form toward team improvement as it is in the NBA, for example. No league openly encourages the approach, yet the course of action is not without p... [1088 chars]","url":"https://bleacherreport.com/articles/10081905-nfl-teams-that-must-consider-tanking-for-caleb-williams-in-2024-draft-as-top-priority","image":"https://media.bleacherreport.com/image/upload/x_99,y_74,w_1662,h_1107,c_crop/c_fill,g_faces,w_3800,h_2000,q_95/v1688738707/qdpwvo6zbcxtjaprptn9.jpg","publishedAt":"2023-07-08T15:44:09Z","source":{"name":"Bleacher Report","url":"https://bleacherreport.com"}},{"title":"Liverpool forward named, as Man Utd plot second attacker signing after Hojlund, Greenwood transfers gather pace","description":"Man Utd want a second addition to their forward line amid transfers for Rasmus Hojlund and Mason Greenwood taking shape, with a report citing a Liverpool attacker as the perfect example of what Erik ten Hag wants.","content":"Man Utd want a second addition to their forward line amid transfers for Rasmus Hojlund and Mason Greenwood taking shape, with a report citing a Liverpool attacker as the perfect example of what Erik ten Hag wants.\\nThe Red Devils have added Mason Moun... [2759 chars]","url":"https://www.teamtalk.com/manchester-united/liverpool-forward-named-man-utd-plot-second-attacker-signing-rasmus-hojlund-mason-greenwood-transfers-gather-pace","image":"https://images.teamtalk.com/content/uploads/2023/05/25082317/Erik-ten-Hag-Jurgen-Klopp.jpg","publishedAt":"2023-07-08T11:44:27Z","source":{"name":"Teamtalk.com","url":"https://www.teamtalk.com"}},{"title":"Top 10 Hardest and Easiest Spelling Bee Words, July 1-7","description":"Another example of how an excellent vocabulary is the currency of this realm.","content":"Here are the meanings of the least-found words that were used in (mostly) recent Times articles.\\n1. riyal \xe2\x80\x94 the currency of Saudi Arabia, Yemen and Qatar:\\nThey could have come by car, they said \xe2\x80\x94 Doha is about six hours from Riyadh \xe2\x80\x94 but Qatar, nervo... [3575 chars]","url":"https://www.nytimes.com/2023/07/08/upshot/spelling-bee-words.html","image":"https://static01.nyt.com/images/2023/07/08/upshot/08up-bee-hardest/08up-bee-hardest-facebookJumbo.png","publishedAt":"2023-07-08T09:00:34Z","source":{"name":"The New York Times","url":"https://www.nytimes.com"}},{"title":"China and Latin America\'s renewable energy boom","description":"Chile is a clear example of just how deeply embedded in Latin America China has become.","content":"The story of renewable energy\xe2\x80\x99s rapid rise in Latin America often focuses on Chinese influence, and for good reason. China\xe2\x80\x99s government, banks and companies have propelled the continent\xe2\x80\x99s energy transition, with about 90% of all wind and solar techno... [7486 chars]","url":"https://fortune.com/2023/07/08/china-secretly-fueling-latin-america-renewable-energy-boom-chile/","image":"https://content.fortune.com/wp-content/uploads/2023/07/GettyImages-1139001201-e1688819040814.jpg?resize=1200,600","publishedAt":"2023-07-08T04:00:00Z","source":{"name":"Fortune","url":"https://fortune.com"}},{"title":"Trump Judge\'s Social Media Ruling Is Bonkers | Opinion","description":"The ruling is a worrisome example of Trump judges using their lifetime positions to prosecute right-wing culture war obsessions rather than objectively interpreting the Constitution.","content":"While you were barbecuing yesterday, or perhaps comforting your pets and children traumatized by ceaseless, wee-hours backyard fireworks shenanigans, a Trump-appointed federal district court judge was issuing a completely bonkers, 155-page injunction... [6287 chars]","url":"https://www.newsweek.com/trump-judges-social-media-ruling-bonkers-opinion-1811141","image":"https://d.newsweek.com/en/full/2254269/social-media-america.jpg","publishedAt":"2023-07-05T17:33:04Z","source":{"name":"Newsweek","url":"https://www.newsweek.com"}},{"title":"Here\'s How Far The 2023 Honda CR-V Hybrid Will Go On A Full Tank","description":"While electric vehicles are the big thing right now, hybrids still save you money at the gas pump. Take Honda\'s 2023 CR-V Hybrid for example.","content":"Here\'s How Far The 2023 Honda CR-V Hybrid Will Go On A Full Tank\\nPushed by high gas prices over the past two decades, more consumers are turning to hybrids to make fewer visits to the pump. The combination of a gas or diesel engine with an electric m... [851 chars]","url":"https://www.slashgear.com/1330524/how-far-2023-honda-cr-v-hybrid-full-tank/","image":"https://www.slashgear.com/img/gallery/heres-how-far-the-2023-honda-cr-v-hybrid-will-go-on-a-full-tank/l-intro-1688491866.jpg","publishedAt":"2023-07-04T13:36:25Z","source":{"name":"SlashGear","url":"https://www.slashgear.com"}},{"title":"Meituan\'s insider AI deal does not compute","description":"China\'s artificial intelligence frenzy has generated some eyebrow-raising deals; a purchase by Meituan is the latest example. The company on Thursday said it is buying AI firm Light Year from Meituan co-founder and former director Wang Huiwen, who only resigned from the $100 billion food delivery outfit days ago due to health reasons.","content":"HONG KONG, June 30 (Reuters Breakingviews) - China\'s artificial intelligence frenzy has generated some eyebrow-raising deals; a purchase by Meituan (3690.HK) is the latest example. The company on Thursday said it is buying AI firm Light Year from Mei... [1679 chars]","url":"https://www.reuters.com/breakingviews/meituans-insider-ai-deal-does-not-compute-2023-06-30/","image":"https://www.reuters.com/resizer/9RwBFbGZUjVgql_o2mE9tzaQzQc=/1200x628/smart/filters:quality(80)/cloudfront-us-east-2.images.arcpublishing.com/reuters/HXK3DLWTJNNK3FMHU4NRHNFTGU.jpg","publishedAt":"2023-07-04T12:16:31Z","source":{"name":"Reuters","url":"https://www.reuters.com"}},{"title":"British brewers reduce alcohol in beers as inflation bites","description":"Brewers in the United Kingdom are cutting the alcohol content \xe2\x80\x94 but not the price \xe2\x80\x94 of several of their most popular beers in what\xe2\x80\x99s been described as another example of \xe2\x80\x9cshrinkflation.\xe2\x80\x9d","content":"London CNN \xe2\x80\x94\\nBrewers in the United Kingdom are cutting the alcohol content \xe2\x80\x94 but not the price \xe2\x80\x94 of several of their most popular beers in what\xe2\x80\x99s been described as another example of \xe2\x80\x9cshrinkflation.\xe2\x80\x9d\\nGreene King, a major UK brewer and pub chain, has ... [3313 chars]","url":"https://edition.cnn.com/2023/06/19/business/uk-beer-alcohol-cut-inflation/index.html","image":"https://media.cnn.com/api/v1/images/stellar/prod/230619110421-uk-beer-alcohol-cut.jpg?c=16x9&q=w_800,c_fill","publishedAt":"2023-07-04T04:00:00Z","source":{"name":"Cable News Network","url":"https://edition.cnn.com"}},{"title":"Indiana Jones And The Dial Of Destiny\'s Disappointing Box Office Must Serve As A Lesson To Hollywood","description":"This is the latest example of a Hollywood studio letting a blockbuster budget get totally out of control.","content":"Indiana Jones And The Dial Of Destiny\'s Disappointing Box Office Must Serve As A Lesson To Hollywood\\nOne of the biggest movies of the summer arrived over the weekend in the form of \\"Indiana Jones and the Dial of Destiny.\\" Unfortunately for Disney and... [1487 chars]","url":"https://www.slashfilm.com/1329502/indiana-jones-and-the-dial-of-destinys-disappointing-box-office-lesson-to-hollywood/","image":"https://www.slashfilm.com/img/gallery/indiana-jones-and-the-dial-of-destinys-disappointing-box-office-must-serve-as-a-lesson-to-hollywood/l-intro-1688401634.jpg","publishedAt":"2023-07-03T12:58:19Z","source":{"name":"/FILM","url":"https://www.slashfilm.com"}},{"title":"Bragg singled Daniel Penny out, but mentally ill are real subway threat","description":"Whether Manhattan DA Alvin Bragg is trying to make an example of Penny because it\xe2\x80\x99s politically convenient is irrelevant to the larger problem: Dangerous people running around free in the subway system.","content":"Yes, there are differences between the Daniel Penny case and that of \xe2\x80\x9cJ train stabber\xe2\x80\x9d Jordan Williams.\\nThe man Penny killed, disturbed vagrant Jordan Neely, had not (far as we know) attacked any passengers in the subway car where he was making viole... [1629 chars]","url":"https://nypost.com/2023/07/02/bragg-singled-daniel-penny-out-but-mentally-ill-are-real-subway-threat/","image":"https://nypost.com/wp-content/uploads/sites/2/2023/07/editorial-daniel-penny-hp.jpg?quality=75&strip=all&1688302976&w=1024","publishedAt":"2023-07-02T17:15:07Z","source":{"name":"New York Post","url":"https://nypost.com"}}]}'
        response = json.loads(response)
        return response['articles']


        # url = f"https://gnews.io/api/v4/search?q=example&lang=en&country=gb" \
        #       f"&from={self.target_data.date()}T{self.target_data.time()}Z" \
        #       f"&apikey={self.news_api_key}"
        # with urllib.request.urlopen(url) as response:
        #     response = json.loads(response)
        #
        # return response['articles']